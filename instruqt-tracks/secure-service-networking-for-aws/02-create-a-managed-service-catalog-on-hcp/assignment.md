---
slug: create-a-managed-service-catalog-on-hcp
id: ltqucwm9rxxo
type: challenge
title: Create a managed Service Catalog on HCP
teaser: In this challenge you will create a Consul Cluster on the HashiCorp Cloud
  Platform (HCP), and two AWS VPCs for "development" and "production" workloads.
notes:
- type: video
  url: ../assets/video/SSN4AWS-Challenge2.mp4
tabs:
- title: Infrastructure Overview
  type: website
  url: https://htmlpreview.github.io/?https://raw.githubusercontent.com/hashicorp/field-workshops-consul/master/instruqt-tracks/secure-service-networking-for-aws/assets/images/ssn4aws-infra-overview.html
- title: App Architecture Overview
  type: website
  url: https://htmlpreview.github.io/?https://raw.githubusercontent.com/hashicorp/field-workshops-consul/master/instruqt-tracks/secure-service-networking-for-aws/assets/images/ssn4aws-app-overview.html
- title: HCP Consul
  type: website
  url: https://portal.cloud.hashicorp.com:443/sign-up
  new_window: true
- title: code - HCP
  type: code
  hostname: shell
  path: /root/terraform/tf-deploy-hcp-consul
- title: code - HCP Config
  type: code
  hostname: shell
  path: /root/config/
- title: Cloud Consoles
  type: service
  hostname: shell
  path: /
  port: 80
- title: Shell
  type: terminal
  hostname: shell
difficulty: basic
timelimit: 600
---
We're going to use terraform to deploy both HCP Consul and HCP Vault. To do this, first we need to create an HCP account from which we can provision services.

In this section you will use terraform to provision an HCP Consul cluster peered to your Instruqt AWS account.

When you are ready to provision the resources, in the `shell` tab, execute:

```sh
nohup terraform apply -auto-approve > /root/terraform/tf-deploy-hcp-consul/hcp.out &
```

NOTE: we run this in the background (`nohup` / `&`) so that it continues even if your communication with the Instruqt platform is interrupted.

The HPC Consul deployment takes a few minutes to create the resources: consul cluster, vpcs, peering, routes, etc.

You can monitor the progress of the deployment using the following command:

```sh
tail -f /root/terraform/tf-deploy-hcp-consul/hcp.out
```

While thats running, lets take a look at what we're building in the `code - HCP` tab.

HCP Consul generates the cregistration file requires for connecting consul agents to the HCP Consul cluster. To read the consul config file, execute the following command:

```sh
terraform output -raw hcp_consul_config_file | base64 -d | jq
```

Save some of the HCP output for later reference with the following commands:
===


First we shall grab the consul agent configuration file generated by HCP:
```sh
terraform output -raw hcp_consul_config_file | base64 -d | jq > /root/config/hcp_client_config.json
```

Now we shall grab the HCP Consul CA for our EKS deployments:
```sh
terraform output -raw hcp_consul_ca_file | base64 -d > /root/config/hcp_ca.pem
```

Review the output in the `code - HCP Config` tab.