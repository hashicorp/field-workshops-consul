---
slug: create-a-managed-service-catalog-on-hcp
id: ytwitm5k88ks
type: challenge
title: Create a managed Service Catalog on HCP
teaser: In this challenge you will create a Consul Cluster on the HashiCorp Cloud
  Platform (HCP).
notes:
- type: text
  contents: In this challenge you will create a Consul cluster on the HashiCorp Cloud
    Platform (HCP).
tabs:
- title: Infrastructure Overview
  type: website
  url: https://htmlpreview.github.io/?https://raw.githubusercontent.com/hashicorp/field-workshops-consul/master/instruqt-tracks/secure-service-networking-for-aws/assets/images/ssn4aws-infra-overview.html
- title: HCP Consul
  type: website
  url: https://portal.cloud.hashicorp.com:443/sign-up
  new_window: true
- title: code - HCP
  type: code
  hostname: shell
  path: /root/terraform/tf-deploy-hcp-consul
- title: code - HCP Config
  type: code
  hostname: shell
  path: /root/config/
- title: Cloud Consoles
  type: service
  hostname: shell
  path: /
  port: 80
- title: Shell
  type: terminal
  hostname: shell
difficulty: basic
timelimit: 900
---
In this chellenge we're going to use terraform to deploy HCP Consul - a control-plane for multi-plaform secure, service networking. There are two parts:

1) Deploy the Consul cluster on HCP
2) Extract configuration from the output

Continue with the steps below:

1) Deploy HCP Consul
===

In the `shell` tab, execute:

```sh
nohup terraform apply -auto-approve > /root/terraform/tf-deploy-hcp-consul/hcp.out &
```

NOTE: we run this in the background (`nohup` / `&`) so that it continues even if your communication with the Instruqt platform is interrupted.

The HPC Consul deployment takes a few minutes to create the required resources. You can monitor the progress of the deployment using the following command:

```sh
tail -f /root/terraform/tf-deploy-hcp-consul/hcp.out
```

You may also wish to view the `HashiCorp Virtual Network` and `Consul` Service being created via the HCP web interface.

While that's running, do the following:

1) Take a look at what we're building in the `code - HCP` tab.
2) Login to your AWS Console using the credentials in the `Cloud Consoles` tab - we'll need this later.

Once the `terraform apply` has finished, you can move onto step 2, below.


2) Extract configuration from the output
===

HCP Consul auto-generates the consul agent configuration file required for connecting consul agents to the HCP Consul cluster. To read the consul config file, execute the following command:

```sh
terraform output -raw hcp_consul_config_file | base64 -d | jq
```

Save some of the HCP output for later reference with the following commands:

First we shall grab the consul agent configuration file generated by HCP:
```sh
terraform output -raw hcp_consul_config_file | base64 -d | jq > /root/config/hcp_client_config.json
```

Now we shall grab the HCP Consul CA for our EKS & ECS deployments:
```sh
terraform output -raw hcp_consul_ca_file | base64 -d > /root/config/hcp_ca.pem
```

Review the output in the `code - HCP Config` tab.